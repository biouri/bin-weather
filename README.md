# BIN-Weather

Description: CLI for getting weather

## Git

1. Инициализация репозитория Git в проекте.
2. Добавление изменений и выполнение первого коммита.
3. Переименование основной ветки в main.
4. Подключение внешнего репозитория origin.
5. Отправить во внешний репозиторий origin ветку main.

```bash
git init
git add .
git commit -m "Create NodeJS BIN-Weather Project with README.md + package.json"
git branch -M main
git remote add origin https://github.com/biouri/bin-weather.git
git push -u origin main
```

```bash
git commit -m "Configure package.json + Parsing command line arguments: args.js"
```

## Приложение BIN-Weather

1. Приложение на Node.js.

- Установка как глобальный npm-пакет.
- Общий вид приложения с параметрами запуска.

2. Функционал приложения

- Возможность запуска без параметров для получения погоды.

Команды для настройки:

- `Без параметров`: вывод текущей погоды.
- `--help`: информация и подсказки по командам.
- `-s <город>`: выбор и валидация города.
- `-t <токен>`: токен для API погоды.

3. Ключевые компоненты приложения

- Получение аргументов: обработка команд пользователя.
- Работа с файловой системой: сохранение настроек и токена.
- Интеграция с внешним API (`OpenWeather`) для получения данных о погоде.
- Стилизация вывода в консоль: визуальное оформление информации.
- Использование библиотеки OS из стандарта `Node.js`.

4. Интеграция с API `OpenWeather`

https://openweathermap.org/

- Бесплатный тариф: до 60 запросов в минуту и 1 миллион запросов в месяц.
- Возможности масштабирования приложения.

## Аргументы командной строки

Основной файл - `weather.js`.
Обновим `package.json` для указания точки входа и настройки бинарного вызова.

### Настройка `package.json`:

1. Указываем `main` файл: `weather.js` (как точка входа приложения).
2. Настроим бинарник:

- Название: `weather`.
- Файл: `weather.js`.

```json
...
  "main": "weather.js",
  "bin": {
    "weather": "weather.js"
  },
  "type": "module",
...
```

Такая настройка bin-секции означает, что при установке приложения глобально будет активна команда `weather` по которой запустится `weather.js` (в этом случае нужно добавить в начале файла `weather.js` строку `#! /usr/bin/env node`). Можно также указать `"weather": "node weather.js"`. Вместо `common.js` модулей будем использовать импорт ES6 модулей, для этого добавляем в конфигурацию: `"type": "module"`, без этой строки необходимо называть файлы-модули с расширением `*.mjs`.

### Конфигурация запуска файла:

Добавляем в начале файла `weather.js` строку `#! /usr/bin/env node` для указания окружения выполнения.

### Разработка `weather.js`:

1. Инициализация приложения
2. Вывод стартового сообщения в консоль.

```javascript
// Функция, которую будем вызывать в рамках запуска CLI
const initCLI = () => {
  // process - глобальная переменная с информацией о процессе
  // process. просмотр доступных методов и переменных
  console.log(process.argv);
  const args = getArgs(process.argv);
  console.log(args);
  // Вывести погоду
  console.log("Weather APP");
};

initCLI();
```

3. Разбор аргументов командной строки с использованием `process.argv`.

- Аргументы передаются в виде массива.
  Например, первый аргумент: чем выполняется, второй аргумент: точка входа.

```bash
node weather.js -h -s Moscow -t AB4434553450982340598
```

```text
[
  'C:\\Program Files\\nodejs\\node.exe',
  'D:\\Projects\\node_abc\\bin-weather\\weather.js',
  '-h',
  '-s',
  'Moscow',
  '-t',
  'AB4434553450982340598'
]
```

- Обработка и вывод дополнительных аргументов.

### Реализация разбора аргументов:

- Цель: упростить аргументы в объект для легкой работы.
- Создание хелпера в папке `helpers` для разбора аргументов (`args.js`).

```javascript
const getArgs = (args) => {
  const res = {};
  // Игнорировать первые два аргумента
  // Используется rest синтаксис для массивов
  // rest это массив без первых 2-х аргументов
  const [executer, file, ...rest] = args;
  rest.forEach((value, index, array) => {
    if (value.charAt(0) == "-") {
      if (index == array.length - 1) {
        // Это последний элемент, true = значит мы его нашли
        res[value.substring(1)] = true;
      } else if (array[index + 1].charAt(0) != "-") {
        // Значение элемента берем из следующего элемента
        res[value.substring(1)] = array[index + 1];
      } else {
        // Это элемент за которым есть параметр с дефисом -
        res[value.substring(1)] = true;
      }
    }
  });
  return res;
};

export { getArgs };
```

### Разбор аргументов командной строки:

1. Пропускаем первые два аргумента массива (исполняемый файл и файл скрипта).
2. Обрабатываем остальные аргументы:

- Определение ключей и значений.
- Обработка ключей с `-`.
- Присвоение `true` для одиночных флагов.

`weather.js`

```javascript
#!/usr/bin/env node
import { getArgs } from "./helpers/args.js";

// Функция, которую будем вызывать в рамках запуска CLI
const initCLI = () => {
  // process - глобальная переменная с информацией о процессе
  // process. просмотр доступных методов и переменных
  console.log(process.argv);
  const args = getArgs(process.argv);
  console.log(args);
  if (args.h) {
    // Вывод help
  }
  if (args.s) {
    // Сохранить город
  }
  if (args.t) {
    // Сохранить токен
  }
  // Вывести погоду
  console.log("Weather APP");
};

initCLI();
```

### Итоги разбора:

```shell
node weather.js -h -s Moscow -t AB4434553450982340598
```

```text
{ h: true, s: 'Moscow', t: 'AB4434553450982340598' }
```

- Получаем объект с аргументами для удобной работы.
- Можно использовать для выполнения соответствующих команд в приложении (например, вывод помощи, сохранение города, токена).
- Была реализована простая система разбора аргументов CLI без использования сторонних библиотек.
- Для продвинутой работы с аргументами рекомендуется использовать готовые решения, например, библиотеку `yargs`.
